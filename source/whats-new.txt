==========
What's New
==========

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Learn what's new in:

* :ref:`Version 4.6 <version-4.6>`
* :ref:`Version 4.5 <version-4.5>`
* :ref:`Version 4.4 <version-4.4>`
* :ref:`Version 4.3 <version-4.3>`
* :ref:`Version 4.2 <version-4.2>`
* :ref:`Version 4.1 <version-4.1>`
* :ref:`Version 4.0 <version-4.0>`

.. _version-4.6:

What's New in 4.6
-----------------

New features of the 4.6 Java driver release include:

- The buffer pool is now shared across all ``MongoClient`` instances. The
  buffer pool prunes buffers that have been idle for one minute.
- Added an API to specify suppliers for AWS KMS credentials for
  Client-Side Field Level Encryption (CSFLE). See the
  `AutoEncryptionSettings.Builder.kmsProviderPropertySuppliers() <https://mongodb.github.io/mongo-java-driver/4.6/apidocs/mongodb-driver-core/com/mongodb/AutoEncryptionSettings.Builder.html#kmsProviderPropertySuppliers(java.util.Map)>`__
  and the `ClientEncryptionSettings.Builder.kmsProviderPropertySuppliers() <https://mongodb.github.io/mongo-java-driver/4.6/apidocs/mongodb-driver-core/com/mongodb/ClientEncryptionSettings.html#getKmsProviderPropertySuppliers()>`__
  API documentation for more information.
- Added compatibility to ``org.mongodb:mongodb-crypt``, a dependency for
  CSFLE, for Apple M1 ARM-based hardware.
- Added a service provider interface (SPI) to allow the driver to specify
  a custom DNS client. See the `DnsClient <https://mongodb.github.io/mongo-java-driver/4.6/apidocs/mongodb-driver-core/com/mongodb/spi/dns/DnsClient.html>`__
  and the `DnsClientProvider <https://mongodb.github.io/mongo-java-driver/4.6/apidocs/mongodb-driver-core/com/mongodb/spi/dns/DnsClientProvider.html>`__
  interface API documentation for more information.
- Added driver support for encoding and decoding between `Java records <https://docs.oracle.com/en/java/javase/17/language/records.html>`__
  and BSON documents, which is enabled by default. See :ref:`<fundamentals-records>`
  for more information.

.. _version-4.5:

What's New in 4.5
-----------------

New features of the 4.5 Java driver release include:

- Added support for specifying custom service names of SRV resource
  records. See the ``srvServiceName`` setting in the :ref:`Connection
  Options <connection-options>` guide for more information.
- Added support to customize UUID representation in a codec registry using
  the ``CodecRegistries.withUuidRepresentation()`` method.
- Added support for overriding listener settings in ``ClusterSettings``,
  ``ServerSettings`` and ``ConnectionPoolSettings`` builders.
- All events received by ``ClusterListener``, ``ServerListener``, and
  ``ServerMonitorListener`` are now totally ordered using
  a happens-before relationship when the listeners are not shared by
  different MongoClient instances. To learn more about the happens-before
  ordering, see `Happens-before Order <https://docs.oracle.com/javase/specs/jls/se17/html/jls-17.html#jls-17.4.5>`__
  in the Java Language Specification.
- Added ``EnumCodec`` and ``EnumCodecProvider`` classes to separate codec
  support for ``enum`` types from the ``PojoCodec`` class. The default
  codec registries, accessible from the ``MongoClientSettings`` and the ``Bson``
  interfaces, now include the ``enum`` codec classes. If your application uses
  a custom enumeration codec and one of the default registries, ensure
  you order them as described in the section on :ref:`overriding codecs <codecs-override>`.
- Resolved performance issues that impacted versions 4.4 and 4.3 of the
  driver. Performance in this version should be similar to performance in 4.2.
- Resolved an issue in which errors originating from retrieving the cluster
  description weren't passed to the ``onError`` Subscriber callback
- Resolved an issue with releasing ``ByteBuf`` instances when you connect
  with compression enabled.
- Removed an unnecessary dependency on the ``javax.annotation.*`` packages
  from the ``org.mongodb.driver-core`` OSGi bundle.

.. _version-4.4:

What's New in 4.4
-----------------

New features of the 4.4 Java driver release include:

- Compatibility with MongoDB 5.1 and support for Java 17
- Added support for index hints in an ``AggregateIterable``
- Added support for the ``$merge`` and ``$out`` aggregation stages on secondaries
- Use of the ``mergeObjects()`` method in the ``Updates`` builder
- ``DocumentCodec`` does not ignore a :ref:`CodecRegistry <codecs-codecregistry>` when writing to an ``Iterable`` or a ``Map`` instance

.. _version-4.3:

What's New in 4.3
-----------------

New features of the 4.3 Java driver release include:

- Added support for the MongoDB {+stable-api+}. For more information, see our
  :ref:`{+stable-api+} guide <stable-api-java>`.

  .. note::

     Starting from February 2022, the **Versioned API** is known the
     **{+stable-api+}**. All concepts and features remain the same with this
     naming change.

- Added support for connection to
  `MongoDB Atlas Serverless Instances <https://www.mongodb.com/cloud/atlas/serverless>`__.
  For more information on setup, see our documentation on how to
  :atlas:`Create a New Serverless Instance </tutorial/create-new-serverless-instance/?jmp=docs_driver_java>`
- Added a builder API for the ``setWindowFields`` pipeline stage to allow the use of window operators
- Added support for setting Netty `io.netty.handler.ssl.SslContext <https://netty.io/4.1/api/io/netty/handler/ssl/SslContext.html>`__
- Added support for snapshot reads to ``ClientSession``
- Limited the rate of establishing new connections per connection pool
- Removed most restrictions on allowed characters in the field names of documents you insert or replace. This is a behavioral change for any application that is relying on client-side enforcement of these restrictions.

The following table shows the restriction status on allowed characters
in the field names of documents:

.. list-table::
   :header-rows: 1
   :stub-columns: 1
   :widths: 15 25 60

   * - Character
     - Operation
     - Description

   * - **.**
     - Insert and Replace
     - Removed restrictions on field names containing this character.

   * - **$**
     - Insert
     - Removed restrictions on field names starting with this character.

   * - **$**
     - Replace
     - Removed restrictions in nested documents on field names containing this character.

   * - **$**
     - Replace
     - Kept restrictions in top-level documents on field names starting with this character. This prevents accidental use of a replace operation when the intention was to use an update operation.

.. note::

   Unacknowledged writes using dollar-prefixed or dotted keys may
   be silently rejected by pre-5.0 servers, where some restrictions on
   field names are still enforced in the server.

.. _version-4.2:

What's New in 4.2
-----------------

New features of the 4.2 Java driver release include:

- Added Azure and GCP key stores to client-side field level encryption
- Added Kerberos caching tickets for reuse in multiple authentication requests- Added `MongoClients <https://mongodb.github.io/mongo-java-driver/4.2/apidocs/mongodb-driver-sync/com/mongodb/client/MongoClients.html>`_ instances with ``MongoClientSettings`` or ``ConnectionString`` as the configuration
- Use of the ``explain()`` method on `find <https://mongodb.github.io/mongo-java-driver/4.2/apidocs/mongodb-driver-sync/com/mongodb/client/FindIterable.html#explain()>`_ and `aggregate <https://mongodb.github.io/mongo-java-driver/4.2/apidocs/mongodb-driver-sync/com/mongodb/client/AggregateIterable.html#explain()>`_ commands
- Added a `JsonObject <https://mongodb.github.io/mongo-java-driver/4.2/apidocs/bson/org/bson/json/JsonObject.html>`_ class to make encoding from and decoding to JSON more efficient by avoiding an intermediate Map representation
- Added a `BsonRepresentation <https://mongodb.github.io/mongo-java-driver/4.2/apidocs/bson/org/bson/codecs/pojo/annotations/BsonRepresentation.html>`_ annotation that allows you to represent the ``ObjectId`` BSON values as a ``String`` in `POJO <https://en.wikipedia.org/wiki/Plain_old_Java_object>`_ classes
- Added a `Filters.empty() <https://mongodb.github.io/mongo-java-driver/4.2/apidocs/mongodb-driver-core/com/mongodb/client/model/Filters.html#empty()>`_ method

.. important::

   There are breaking changes that may affect your application. See the
   `Upgrading Guide <https://mongodb.github.io/mongo-java-driver/4.2/upgrading/>`_
   for more information.

.. _version-4.1:

What's New in 4.1
-----------------

New features of the 4.1 Java driver release include:

- Significant reduction in client-perceived failover times during planned maintenance events
- The `update() <https://mongodb.github.io/mongo-java-driver/4.1/apidocs/mongodb-driver-core/com/mongodb/client/model/UpdateOptions.html#hint(org.bson.conversions.Bson)>`_ and `delete() <https://mongodb.github.io/mongo-java-driver/4.1/apidocs/mongodb-driver-core/com/mongodb/client/model/DeleteOptions.html#hint(org.bson.conversions.Bson)>`_ methods now support index hints
- The ``find()`` method supports `allowDiskUse() <https://mongodb.github.io/mongo-java-driver/4.1/apidocs/mongodb-driver-sync/com/mongodb/client/FindIterable.html#allowDiskUse(java.lang.Boolean)>`_ for sorts that require too much memory to execute in RAM
- Added support for the MONGODB-AWS authentication mechanism using Amazon Web Services (AWS) Identity and Access Management (IAM) credentials
- Authentication requires fewer round trips to the server, resulting in faster connection setup

.. _version-4.0:

What's New in 4.0
-----------------

This release adds no new features.
